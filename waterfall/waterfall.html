<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Waterfall</title>
    <style>
        body {
            margin: 0;
        }

        #ul1 {
            width: 1080px;
            margin: 100px auto 0;
        }

        li {
            width: 247px;
            list-style: none;
            float: left;
            margin-right: 10px;
        }

        li div {
            border: 1px solid #000;
            padding: 10px;
            margin-bottom: 10px;
        }

        li div img {
            width: 225px;
            display: block;
        }
    </style>
    <script src="ajax.js"></script>
    <script>
        window.onload = function () {
            var oUl = document.getElementById("ul1");
            var aLi = oUl.getElementsByTagName("li");
            var iLen = aLi.length;

            //初始化数据处理

            ajax('get', 'getPics.php', 'cpage=1', function (data) {
                var data = JSON.parse(data);
                for (var i = 0; i < data.length; i++) {

                    //获取高度最短的一列li
                    var _index = getShort();

                    var oDiv = document.createElement('div');
                    var oImg = document.createElement('img');
                    oImg.src = data[i].preview;
                    oDiv.appendChild(oImg);
                    var oP = document.createElement('p');
                    oP.innerHTML = data[i].title;
                    oDiv.appendChild(oP);

                    aLi[_index].appendChild(oDiv);


                }
            });

            //封装一个函数，找最短的一列li
            function getShort() {
                var index = 0;
                var ih = aLi[index].offsetHeight;
                for (var i = 1; i < iLen; i++) {
                    if (aLi[i].offsetHeight < ih) {
                        index = i;
                        ih = aLi[i].offsetHeight;
                    }

                }
                return index;
            }
        }
    </script>
</head>
<body>
<ul id="ul1">
    <li></li>
    <li></li>
    <li></li>
    <li></li>
</ul>
</body>
</html>